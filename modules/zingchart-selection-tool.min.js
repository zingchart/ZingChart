/*
All of the code within the ZingChart software is developed and copyrighted by ZingChart, Inc., and may not be copied,
replicated, or used in any other software or application without prior permission from ZingChart. All usage must coincide with the
ZingChart End User License Agreement which can be requested by email at support@zingchart.com.

Build 2.9.15
*/
zingchart.setModule("selection-tool"),zingchart.plugins.selectionTool=zingchart.plugins.selectionTool||{},zingchart.plugins.selectionTool.freeFormType={},zingchart.plugins.selectionTool.filter={text:"",nodes:[]},zingchart.plugins.selectionTool.charts=zingchart.plugins.selectionTool.charts||{},zingchart.plugins.selectionTool.angle2D=function(e,i,t,o){for(var i=Math.atan2(i,e),n=Math.atan2(o,t)-i;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;return n},zingchart.plugins.selectionTool.isInsidePolygon=function(e,i,t){for(var o=0,n=[],l=[],a=e.length,c=0;c<a;c++)n[0]=e[c][0]-i,n[1]=e[c][1]-t,l[0]=e[(c+1)%a][0]-i,l[1]=e[(c+1)%a][1]-t,o+=zingchart.plugins.selectionTool.angle2D(n[0],n[1],l[0],l[1]);return Math.abs(o)>=Math.PI},zingchart.plugins.selectionTool.intersectRect=function(e,i){return!(i.iX>e.iX+e.I||i.iX+i.I<e.iX||i.iY>e.iY+e.F||i.iY+i.F<e.iY)},zingchart.plugins.selectionTool.checkAgainstFilters=function(UW){var bValidNode=!0,sFilterText=zingchart.plugins.selectionTool.filter.text;if(""!==sFilterText){bValidNode=!1,sFilterText=sFilterText.replace(/%plot-index/gi,UW.plotindex).replace(/%node-index/gi,UW.index).replace(/%node-keyvalue/gi,UW.keyvalue).replace(/%node-value/gi,UW[ZC._[9]]);try{bValidNode=eval(sFilterText)}catch(e){bValidNode=!1}}if(!bValidNode){var aFilterNodes=zingchart.plugins.selectionTool.filter.nodes;if(aFilterNodes.length)for(var bValidNode=!1,i=0;i<aFilterNodes.length;i++)if(null!==ZC._n_(aFilterNodes[i].plotindex)&&aFilterNodes[i].plotindex===UW.plotindex&&(null!==ZC._n_(aFilterNodes[i].index)&&aFilterNodes[i].index===UW.index||null!==ZC._n_(aFilterNodes[i].keyvalue)&&aFilterNodes[i].keyvalue===UW.keyvalue)){bValidNode=!0;break}}return bValidNode},!function(){var T=-1,m=-1,Z=[],_="",l=null,n=!1,o=!1,F=function(e){zingchart.exec(e.id,"removeobject",{type:"shape",id:e.id+"-selection-poly"}),zingchart.exec(e.id,"removeobject",{type:"label",id:e.id+"-selection-rectangle"}),Z=[],m=T=-1,_=""},a=function(e,i){var t,o;n&&(t={},(o=(o=(o=zingchart.getLoader(e.id)).MF||o.o)[ZC._[16]]?o[ZC._[16]][0]:o)["selection-tool"]&&o["selection-tool"].cursor&&(t=o["selection-tool"].cursor,ZC._todash_(t)),o={id:e.id+"-selection-cursor",type:"plus",x:e.x,y:e.y,"line-width":1,"line-color":"#cc0000",size:5,alpha:e.ev.shiftKey||e.ev.metaKey||i?1:0,flat:!0},t.label&&(o.label={anchor:"bl",alpha:e.ev.shiftKey||e.ev.metaKey||i?1:0,text:"Click to add points"}),ZC._cp_(t,o),zingchart.exec(e.id,"addobject",{type:"shape",data:o}))},c=function(e,i){n&&zingchart.exec(e.id,"updateobject",{type:"shape",id:e.id+"-selection-cursor",data:{x:e.x,y:e.y,alpha:e.ev.shiftKey||e.ev.metaKey||i?1:0,label:{alpha:e.ev.shiftKey||e.ev.metaKey||i?1:0}}})},i=function(e){o=!1,zingchart.exec(e.id,"removeobject",{type:"shape",id:e.id+"-selection-cursor"})},t=function(i){if(""!==_){var e,t,o,n,l,a=zingchart.getLoader(i.id),c=[],r=[],d=[],s=null,h=zingchart.exec(i.id,"getplotlength",{graphid:i.graphid});if(_="",i.ev.shiftKey||i.ev.metaKey||16===i.ev.keyCode){for(2<=Z.length&&Z.push([i.x,i.y]),C=0;C<h;C++)for(t=zingchart.exec(i.id,"getobjectinfo",{graphid:i.graphid,object:"plot",plotindex:C}),d[C]=t.xdata["append-selection"],n=zingchart.exec(i.id,"getnodelength",{graphid:i.graphid,plotindex:C}),e=0;e<n;e++)o=zingchart.exec(i.id,"getobjectinfo",{graphid:i.graphid,object:"node",plotindex:C,nodeindex:e}),null===ZC._n_(o)||o.xdata["ignore-selection"]||(zingchart.plugins.selectionTool.isInsidePolygon(Z,o.x,o.y)||zingchart.plugins.selectionTool.isInsidePolygon(Z,o.x+o.width,o.y)||zingchart.plugins.selectionTool.isInsidePolygon(Z,o.x+o.width,o.y+o.height)||zingchart.plugins.selectionTool.isInsidePolygon(Z,o.x,o.y+o.height))&&zingchart.plugins.selectionTool.checkAgainstFilters(o)&&(r.push(o),null===ZC._n_(c[C])&&(c[C]=[]),c[C].push(e));(s=a.FH()).poly=Z,ZC.AO.C0("zingchart.plugins.selection-tool.mouseup",a,s)}else if(-1!==T&&-1!==m){var g,p,u,y,f=Math.min(T,i.x),x=Math.max(T,i.x),b=Math.min(m,i.y),z=Math.max(m,i.y);if(x-f<4||z-b<4)return;for(Z=[[f,b],[f,z],[x,z],[x,b],[f,b]],C=0;C<h;C++)for(t=zingchart.exec(i.id,"getobjectinfo",{graphid:i.graphid,object:"plot",plotindex:C}),d[C]=t.xdata["append-selection"],l=!1,-1!==ZC.AV(["vbar","hbar","vbar3d","hbar3d"],t.type)&&(l=!0),n=zingchart.exec(i.id,"getnodelength",{graphid:i.graphid,plotindex:C}),e=0;e<n;e++)o=zingchart.exec(i.id,"getobjectinfo",{graphid:i.graphid,object:"node",plotindex:C,nodeindex:e}),null!==ZC._n_(o)&&!o.xdata["ignore-selection"]&&o.onviewport&&(g=o.x,p=o.y,u=o.width,y=o.height,o.bounds&&(g=o.bounds[0],p=o.bounds[1],u=o.bounds[2]-o.bounds[0],y=o.bounds[3]-o.bounds[1]),l&&zingchart.plugins.selectionTool.intersectRect({iX:f,iY:b,I:x-f,F:z-b},{iX:g,iY:p,I:u,F:y})||!l&&zingchart.plugins.selectionTool.isInsidePolygon(Z,o.x,o.y))&&zingchart.plugins.selectionTool.checkAgainstFilters(o)&&(r.push(o),null===ZC._n_(c[C])&&(c[C]=[]),c[C].push(e));(s=a.FH()).poly=Z,ZC.AO.C0("zingchart.plugins.selection-tool.mouseup",a,s)}if(window.setTimeout(function(){F(i)},64),0<c.length){ZC.mobile&&(ZC.move=!1);for(var v=zingchart.exec(i.id,"getselection",{graphid:i.graphid}),C=0;C<v.length;C++)if(d[C]&&v[C])for(c[C]||(c[C]=[]),e=0;e<v[C].length;e++)-1===ZC.AV(c[C],v[C][e])&&c[C].push(v[C][e]);window.setTimeout(function(){i.selection=c,i.nodes=r;var e=ZC.AO.C0("zingchart.plugins.selection-tool.selection",a,i,!0);null!==ZC._n_(e)&&!ZC._b_(e)||zingchart.exec(i.id,"setselection",{graphid:i.graphid,selection:c})},1)}}},r=(zingchart.bind(null,"destroy",function(e){zingchart.plugins.selectionTool.charts[e.id]&&(ZC.A3(document).unbind("keyup",r),ZC.A3(document).unbind("keydown",d),zingchart.plugins.selectionTool.charts[e.id]=null)}),function(e){16===e.keyCode&&null!==l&&(i(l),0<Z.length)&&(t(l),l=null)}),d=(ZC.A3(document).bind("keyup",r),function(e){var i;16===e.keyCode&&0===Z.length&&null!==l&&(e=zingchart.getLoader(l.id),i=zingchart.getModules(e),-1!==ZC.AV(i,"selection-tool"))&&(e=(i=e.MF||e.o)[ZC._[16]]?i[ZC._[16]][0]:i,zingchart.plugins.selectionTool.freeFormType[l.id]="lasso",e["selection-tool"]&&e["selection-tool"]["free-form-type"]&&(zingchart.plugins.selectionTool.freeFormType[l.id]=e["selection-tool"]["free-form-type"]),(o?c:a)(l,!0))});ZC.A3(document).bind("keydown",d),zingchart.bind(null,"dblclick",function(e){0<Z.length&&null!==e&&(t(e),i(e),l=null)}),zingchart.bind(null,ZC._[47],function(e){var i,t,o,n;-1===(l=e).targetid.indexOf(e.graphid+"-preview")&&-1===e.targetid.indexOf(e.graphid+"-scroll")&&(i=(i=(t=zingchart.getLoader(e.id)).MF||t.o)[ZC._[16]]?i[ZC._[16]][0]:i,n=zingchart.getModules(t),-1!==ZC.AV(n,"selection-tool"))&&(zingchart.plugins.selectionTool.charts[e.id]=!0,ZC.mobile||e.ev.preventDefault(),typeof(n=ZC.AO.C0("zingchart.plugins.selection-tool.beforeselection",t,e,!0))===ZC._[31]||n)&&(zingchart.plugins.selectionTool.freeFormType[l.id]||(zingchart.plugins.selectionTool.freeFormType[l.id]="lasso",i["selection-tool"]&&i["selection-tool"]["free-form-type"]&&(zingchart.plugins.selectionTool.freeFormType[l.id]=i["selection-tool"]["free-form-type"])),t={},i["selection-tool"]&&i["selection-tool"].mask&&(t=i["selection-tool"].mask,ZC._todash_(t)),"none"===e.target&&(e.ev.shiftKey||e.ev.metaKey?(Z.push([e.x,e.y]),o={id:e.id+"-selection-poly",type:"poly",points:Z,"border-width":1,"border-color":"#000000","background-color":"#ff9900",alpha:.2,flat:!0},ZC._cp_(t,o),"lasso"===zingchart.plugins.selectionTool.freeFormType[e.id]?zingchart.exec(e.id,"addobject",{type:"shape",data:o}):1===Z.length?(zingchart.exec(e.id,"addobject",{type:"shape",data:o}),zingchart.exec(e.id,"updateobject",{type:"shape",id:e.id+"-selection-cursor",data:{label:{visible:!1}}})):((n=[].concat(Z))[n.length]=[n[0][0],n[0][1]],zingchart.exec(e.id,"updateobject",{type:"shape",id:e.id+"-selection-poly",data:{points:n}}))):-1===T&&-1===m&&(T=e.x,m=e.y,o={id:e.id+"-selection-rectangle",x:T,y:m,width:4,height:4,"border-width":1,"border-color":"#000000","background-color":"#ff9900",alpha:.2,flat:!0},ZC._cp_(t,o),zingchart.exec(e.id,"addobject",{type:"label",data:o}))),_=e.id)}),zingchart.bind(null,ZC._[48],function(e){var i,t=zingchart.getLoader(e.id),t=zingchart.getModules(t);-1!==ZC.AV(t,"selection-tool")&&(n=!0,(l=e).id!==_?""!==_&&F(e):((o?c:(o=!0,a))(e),ZC.mobile||e.ev.preventDefault(),e.ev.shiftKey||e.ev.metaKey?"lasso"===zingchart.plugins.selectionTool.freeFormType[e.id]?0<Z.length&&(Z.push([e.x,e.y]),(i=[].concat(Z))[i.length]=[i[0][0],i[0][1]],zingchart.exec(e.id,"updateobject",{type:"shape",id:e.id+"-selection-poly",data:{points:i}})):0<Z.length&&((i=[].concat(Z)).push([e.x,e.y]),i[i.length]=[i[0][0],i[0][1]],zingchart.exec(e.id,"updateobject",{type:"shape",id:e.id+"-selection-poly",data:{points:i}})):-1!==T&&-1!==m&&zingchart.exec(e.id,"updateobject",{type:"label",id:e.id+"-selection-rectangle",data:{x:Math.min(e.x,T),y:Math.min(e.y,m),width:Math.max(4,Math.abs(e.x-T)),height:Math.max(4,Math.abs(e.y-m))}})))}),zingchart.bind(null,"mouseout",function(e){n=!1,F(e),i(e)}),zingchart.bind(null,ZC._[49],function(e){(!e.ev.shiftKey&&!e.ev.metaKey||"lasso"===zingchart.plugins.selectionTool.freeFormType[e.id])&&t(e)})}();